TAGS_DICT = {
    "СТРАТЕГИЯ": "9",
    "ЭКШЕН": "19",
    "ПРИКЛЮЧЕНИЕ": "21",
    "ДИЗАЙН И ИЛЛЮСТРАЦИЯ": "84",
    "УТИЛИТЫ": "87",
    "БЕСПЛАТНАЯ ИГРА": "113",
    "РОЛЕВАЯ ИГРА": "122",
    "ММО": "128",
    "ИНДИ": "492",
    "РАННИЙ ДОСТУП": "493",
    "КАЗУАЛЬНАЯ ИГРА": "597",
    "СИМУЛЯТОР": "599",
    "ГОНКИ": "699",
    "СПОРТ": "701",
    "ВИДЕОПРОДАКШН": "784",
    "ОБРАБОТКА ФОТО": "809",
    "АНИМАЦИЯ И МОДЕЛИРОВАНИЕ": "872",
    "РАБОТА СО ЗВУКОМ": "1027",
    "ОБРАЗОВАНИЕ": "1036",
    "ВЕБ-ПУБЛИКАЦИЯ": "1038",
    "ОБУЧЕНИЕ РАБОТЕ С ПО": "1445",
    "ПОЕЗДА": "1616",
    "МУЗЫКА": "1621",
    "ПЛАТФОРМЕР": "1625",
    "МЕТРОИДВАНИЯ": "1628",
    "СОБАКИ": "1638",
    "СТРОИТЕЛЬСТВО": "1643",
    "ВОЖДЕНИЕ": "1644",
    "БАШЕННАЯ ЗАЩИТА": "1645",
    "СЛЭШЕР": "1646",
    "ВЕСТЕРН": "1647",
    "GAMEMAKER": "1649",
    "САТИРА": "1651",
    "РАССЛАБЛЯЮЩАЯ": "1654",
    "ЗОМБИ": "1659",
    "ВЫЖИВАНИЕ": "1662",
    "ШУТЕР ОТ ПЕРВОГО ЛИЦА": "1663",
    "ГОЛОВОЛОМКА": "1664",
    "ТРИ В РЯД": "1665",
    "КАРТОЧНАЯ ИГРА": "1666",
    "ХОРРОР": "1667",
    "ПОДДЕРЖКА МОДИФИКАЦИЙ": "1669",
    "4X": "1670",
    "СУПЕРГЕРОИ": "1671",
    "ИНОПЛАНЕТЯНЕ": "1673",
    "ПЕЧАТАНИЕ": "1674",
    "СТРАТЕГИЯ В РЕАЛЬНОМ ВРЕМЕНИ": "1676",
    "ПОШАГОВАЯ": "1677",
    "ВОЙНА": "1678",
    "ОГРАБЛЕНИЯ": "1680",
    "ПИРАТЫ": "1681",
    "ФЭНТЕЗИ": "1684",
    "КООПЕРАТИВ": "1685",
    "СТЕЛС": "1687",
    "НИНДЗЯ": "1688",
    "КЛАССИКА": "1693",
    "ОТКРЫТЫЙ МИР": "1695",
    "ОТ ТРЕТЬЕГО ЛИЦА": "1697",
    "POINT & CLICK": "1698",
    "КРАФТИНГ": "1702",
    "ТАКТИКА": "1708",
    "СЮРРЕАЛИСТИЧНАЯ": "1710",
    "ПСИХОДЕЛИЯ": "1714",
    "РОГАЛИК": "1716",
    "ШЕСТИУГОЛЬНАЯ КАРТА": "1717",
    "MOBA": "1718",
    "ЮМОР": "1719",
    "ПОДЗЕМЕЛЬЯ": "1720",
    "ПСИХОЛОГИЧЕСКИЙ ХОРРОР": "1721",
    "ЭКШЕН-RTS": "1723",
    "СОКОБАН": "1730",
    "ВОКСЕЛЬНАЯ ГРАФИКА": "1732",
    "СУРОВАЯ": "1733",
    "БЫСТРАЯ": "1734",
    "LEGO": "1736",
    "ПОИСК ПРЕДМЕТОВ": "1738",
    "ПОШАГОВАЯ СТРАТЕГИЯ": "1741",
    "ГЛУБОКИЙ СЮЖЕТ": "1742",
    "ФАЙТИНГ": "1743",
    "БАСКЕТБОЛ": "1746",
    "ПО КОМИКСУ": "1751",
    "РИТМ-ИГРА": "1752",
    "СКЕЙТБОРДИНГ": "1753",
    "MMORPG": "1754",
    "КОСМОС": "1755",
    "ОТЛИЧНЫЙ САУНДТРЕК": "1756",
    "ОДНА ЖИЗНЬ": "1759",
    "НАСТОЛЬНАЯ С ПОЛЕМ": "1770",
    "АРКАДА": "1773",
    "ШУТЕР": "1774",
    "ИГРОК ПРОТИВ ИГРОКА": "1775",
    "СТИМПАНК": "1777",
    "ПО МОТИВАМ КНИГИ": "3796",
    "ВИД СБОКУ": "3798",
    "ВИЗУАЛЬНАЯ НОВЕЛЛА": "3799",
    "ПЕСОЧНИЦА": "3810",
    "ТАКТИКА В РЕАЛЬНОМ ВРЕМЕНИ": "3813",
    "ШУТЕР ОТ ТРЕТЬЕГО ЛИЦА": "3814",
    "ИССЛЕДОВАНИЯ": "3834",
    "ПОСТАПОКАЛИПСИС": "3835",
    "ОТ ПЕРВОГО ЛИЦА": "3839",
    "ЛОКАЛЬНЫЙ КООПЕРАТИВ": "3841",
    "СЕТЕВОЙ КООПЕРАТИВ": "3843",
    "ПРОРАБОТАННАЯ ВСЕЛЕННАЯ": "3854",
    "ДЛЯ НЕСКОЛЬКИХ ИГРОКОВ": "3859",
    "2D": "3871",
    "ПЛАТФОРМЕР НА ТОЧНОСТЬ": "3877",
    "СОРЕВНОВАТЕЛЬНАЯ": "3878",
    "ОЛДСКУЛ": "3916",
    "КУЛИНАРИЯ": "3920",
    "ИММЕРСИВНАЯ ИГРА": "3934",
    "НАУЧНАЯ ФАНТАСТИКА": "3942",
    "ГОТИКА": "3952",
    "RAIL SHOOTER": "3954",
    "ЯРКИЙ ГЛАВНЫЙ ГЕРОЙ": "3955",
    "УПРОЩЁННЫЙ РОГАЛИК": "3959",
    "ПИКСЕЛЬНАЯ ГРАФИКА": "3964",
    "ЭПИЧНАЯ": "3965",
    "ФИЗИКА": "3968",
    "ХОРРОР НА ВЫЖИВАНИЕ": "3978",
    "ИСТОРИЧЕСКАЯ": "3987",
    "БОЙ": "3993",
    "РЕТРО": "4004",
    "ВАМПИРЫ": "4018",
    "СЛОЖНАЯ": "4026",
    "ПАРКУР": "4036",
    "ДРАКОНЫ": "4046",
    "МАГИЯ": "4057",
    "ТРИЛЛЕР": "4064",
    "АНИМЕ": "4085",
    "МИНИМАЛИЗМ": "4094",
    "БОЕВЫЕ ГОНКИ": "4102",
    "ПРИКЛЮЧЕНЧЕСКИЙ ЭКШЕН": "4106",
    "КИБЕРПАНК": "4115",
    "СМЕШНАЯ": "4136",
    "ТРАНСГУМАНИЗМ": "4137",
    "КИНЕМАТОГРАФИЧНАЯ": "4145",
    "ВТОРАЯ МИРОВАЯ ВОЙНА": "4150",
    "РАЗДЕЛЕНИЕ НА КЛАССЫ": "4155",
    "BEAT 'EM UP": "4158",
    "В РЕАЛЬНОМ ВРЕМЕНИ": "4161",
    "KIDS": "4162",
    "АТМОСФЕРНАЯ": "4166",
    "ВОЕННЫЕ ДЕЙСТВИЯ": "4168",
    "СРЕДНЕВЕКОВЬЕ": "4172",
    "РЕАЛИЗМ": "4175",
    "ДЛЯ ОДНОГО ИГРОКА": "4182",
    "ШАХМАТЫ": "4184",
    "ЗАТЯГИВАЮЩАЯ": "4190",
    "3D": "4191",
    "МУЛЬТИПЛИКАЦИЯ": "4195",
    "ТОРГОВЛЯ": "4202",
    "РОЛЕВОЙ ЭКШЕН": "4231",
    "КОРОТКАЯ": "4234",
    "ЛУТ": "4236",
    "СЕРИАЛ": "4242",
    "СТИЛИЗАЦИЯ": "4252",
    "SHOOT 'EM UP": "4255",
    "КОСМИЧЕСКИЕ КОРАБЛИ": "4291",
    "БУДУЩЕЕ": "4295",
    "ЦВЕТАСТАЯ": "4305",
    "ПОШАГОВЫЕ СРАЖЕНИЯ": "4325",
    "ГРАДОСТРОЕНИЕ": "4328",
    "МРАЧНАЯ": "4342",
    "МЯСО": "4345",
    "ГЛОБАЛЬНАЯ СТРАТЕГИЯ": "4344",
    "АССАССИНЫ": "4376",
    "АБСТРАКТНАЯ": "4400",
    "ЯПОНСКАЯ РОЛЕВАЯ ИГРА": "4434",
    "КОМПЬЮТЕРНАЯ РОЛЕВАЯ ИГРА": "4474",
    "ВЫБЕРИ СЕБЕ ПРИКЛЮЧЕНИЕ": "4486",
    "СОВМЕСТНАЯ КАМПАНИЯ": "4508",
    "ФЕРМЕРСТВО": "4520",
    "QTE": "4559",
    "МУЛЬТФИЛЬМЫ": "4562",
    "АЛЬТЕРНАТИВНАЯ ИСТОРИЯ": "4598",
    "ТЁМНОЕ ФЭНТЕЗИ": "4604",
    "СРАЖЕНИЯ НА МЕЧАХ": "4608",
    "ШУТЕР С ВИДОМ СВЕРХУ": "4637",
    "НАСИЛИЕ": "4667",
    "ВОЕННЫЕ КОНФЛИКТЫ": "4684",
    "ЭКОНОМИКА": "4695",
    "ФИЛЬМ": "4700",
    "РЕИГРАБЕЛЬНОСТЬ": "4711",
    "МИЛАЯ": "4726",
    "2D-ФАЙТИНГ": "4736",
    "КАСТОМИЗАЦИЯ ПЕРСОНАЖА": "4747",
    "ПОЛИТИКА": "4754",
    "ТВИН-СТИК ШУТЕР": "4758",
    "ЗРЕЛИЩНЫЕ СРАЖЕНИЯ": "4777",
    "ВИД СВЕРХУ": "4791",
    "МЕХИ": "4821",
    "СВОБОДА ДВИЖЕНИЯ": "4835",
    "ЛОКАЛЬНАЯ ИГРА НА ЧЕТВЕРЫХ": "4840",
    "КАПИТАЛИЗМ": "4845",
    "ПОЛИТИЧЕСКАЯ": "4853",
    "ПАРОДИЯ": "4878",
    "ПУЛЕВОЙ АД": "4885",
    "РОМАНТИКА": "4947",
    "ПСЕВДОТРЁХМЕРНОСТЬ": "4975",
    "МОРСКОЙ БОЙ": "4994",
    "АНТИУТОПИЯ": "5030",
    "КИБЕРСПОРТ": "5055",
    "ПОВЕСТВОВАТЕЛЬНАЯ": "5094",
    "ПРОЦЕДУРНАЯ ГЕНЕРАЦИЯ": "5125",
    "KICKSTARTER": "5153",
    "НАБОР ОЧКОВ": "5154",
    "ДИНОЗАВРЫ": "5160",
    "ХОЛОДНАЯ ВОЙНА": "5179",
    "ПСИХОЛОГИЧЕСКАЯ": "5186",
    "КРОВЬ": "5228",
    "СИКВЕЛ": "5230",
    "СИМУЛЯТОР БОГА": "5300",
    "GAMES WORKSHOP": "5310",
    "МОДИФИКАЦИИ": "5348",
    "ДЛЯ ВСЕЙ СЕМЬИ": "5350",
    "РАЗРУШЕНИЯ": "5363",
    "ЗАГОВОР": "5372",
    "2D-ПЛАТФОРМЕР": "5379",
    "ПЕРВАЯ МИРОВАЯ ВОЙНА": "5382",
    "ИГРА НА ВРЕМЯ": "5390",
    "3D-ПЛАТФОРМЕР": "5395",
    "БЕНЧМАРК": "5407",
    "КРАСИВАЯ": "5411",
    "ПРОГРАММИРОВАНИЕ": "5432",
    "ХАКЕРСТВО": "5502",
    "ГОЛОВОЛОМКА-ПЛАТФОРМЕР": "5537",
    "АРЕНА-ШУТЕР": "5547",
    "RPG MAKER": "5577",
    "ЭМОЦИОНАЛЬНАЯ": "5608",
    "ДЛЯ ВЗРОСЛЫХ": "5611",
    "ДЕТЕКТИВ": "5613",
    "КОЛЛЕКТАТОН": "5652",
    "СОВРЕМЕННОСТЬ": "5673",
    "РЕМЕЙК": "5708",
    "КОМАНДНАЯ": "5711",
    "ТАЙНА": "5716",
    "БЕЙСБОЛ": "5727",
    "РОБОТЫ": "5752",
    "КАСТОМИЗАЦИЯ ОРУЖИЯ": "5765",
    "НАУКА": "5794",
    "ЗАМЕДЛЕНИЕ ВРЕМЕНИ": "5796",
    "ИЗОМЕТРИЯ": "5851",
    "СИМУЛЯТОР ХОДЬБЫ": "5900",
    "ТЕННИС": "5914",
    "ЧЁРНЫЙ ЮМОР": "5923",
    "ПЕРЕЗАПУСК": "5941",
    "ГОРНОЕ ДЕЛО": "5981",
    "ДРАМА": "5984",
    "ЛОШАДИ": "6041",
    "НУАР": "6052",
    "ЛОГИКА": "6129",
    "ПТИЦЫ": "6214",
    "МЕНЕДЖМЕНТ ИНВЕНТАРЯ": "6276",
    "ДИПЛОМАТИЯ": "6310",
    "КРИМИНАЛ": "6378",
    "РЕШЕНИЯ С ПОСЛЕДСТВИЯМИ": "6426",
    "3D-ФАЙТИНГ": "6506",
    "ПИНБОЛ": "6621",
    "КОНТРОЛЬ ВРЕМЕНИ": "6625",
    "НАГОТА": "6650",
    "90-Е": "6691",
    "МАРС": "6702",
    "ИГРОК ПРОТИВ ИИ": "6730",
    "РИСОВАННАЯ ГРАФИКА": "6815",
    "НЕЛИНЕЙНАЯ": "6869",
    "ФЛОТ": "6910",
    "БОЕВЫЕ ИСКУССТВА": "6915",
    "РИМ": "6948",
    "НЕСКОЛЬКО КОНЦОВОК": "6971",
    "ГОЛЬФ": "7038",
    "МОЖНО ПРИОСТАНОВИТЬ": "7107",
    "ВЕЧЕРИНКА": "7108",
    "СОЗДАНА НА ПОЖЕРТВОВАНИЯ": "7113",
    "КОМАНДНАЯ ИГРА": "7178",
    "ПРОТАГОНИСТКА": "7208",
    "ЛИНЕЙНАЯ": "7250",
    "ЛЫЖИ": "7309",
    "БОУЛИНГ": "7328",
    "СТРОИТЕЛЬСТВО БАЗЫ": "7332",
    "ЛОКАЛЬНЫЙ МУЛЬТИПЛЕЕР": "7368",
    "СНАЙПЕРСТВО": "7423",
    "ЛАВКРАФТ": "7432",
    "ИЛЛЮМИНАТЫ": "7478",
    "КОНТРОЛЛЕР": "7481",
    "ИГРАЛЬНЫЕ КОСТИ": "7556",
    "ПЕРЕМЕЩЕНИЕ ПО СЕТКЕ": "7569",
    "БЕЗДОРОЖЬЕ": "7622",
    "ПОВЕСТВОВАНИЕ": "7702",
    "80-Е": "7743",
    "КУЛЬТОВАЯ КЛАССИКА": "7782",
    "ДВОРФЫ": "7918",
    "ИСКУССТВЕННЫЙ ИНТЕЛЛЕКТ": "7926",
    "САУНДТРЕК": "7948",
    "ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ": "8013",
    "TRACKIR": "8075",
    "МИНИ-ИГРЫ": "8093",
    "РЕДАКТОР УРОВНЕЙ": "8122",
    "ГЕНЕРАЦИЯ НА ОСНОВЕ МУЗЫКИ": "8253",
    "РАССЛЕДОВАНИЯ": "8369",
    "ХОРОШО НАПИСАННАЯ": "8461",
    "РАННЕР": "8666",
    "УПРАВЛЕНИЕ РЕСУРСАМИ": "8945",
    "ХЕНТАЙ": "9130",
    "ПОДВОДНЫЙ МИР": "9157",
    "ИММЕРСИВНЫЙ СИМУЛЯТОР": "9204",
    "КОЛЛЕКЦИОННАЯ КАРТОЧНАЯ ИГРА": "9271",
    "ДЕМОНЫ": "9541",
    "СИМУЛЯТОР СВИДАНИЙ": "9551",
    "ОХОТА": "9564",
    "ДИНАМИЧЕСКОЕ ПОВЕСТВОВАНИЕ": "9592",
    "СНЕГ": "9803",
    "ПЕРЕЖИВАНИЕ": "9994",
    "СИМУЛЯТОР ЖИЗНИ": "10235",
    "ТРАНСПОРТ": "10383",
    "МЕМЫ": "10397",
    "ВИКТОРИНА": "10437",
    "ПУТЕШЕСТВИЯ ВО ВРЕМЕНИ": "10679",
    "ПАРТИЙНАЯ РОЛЕВАЯ ИГРА": "10695",
    "РАЗДЕЛЕНИЕ ЭКРАНА": "10808",
    "СВЕРХЪЕСТЕСТВЕННОЕ": "10816",
    "ИНТЕРАКТИВНАЯ ЛИТЕРАТУРА": "11014",
    "BOSS RUSH": "11095",
    "ГОНКИ НА ВЫЖИВАНИЕ": "11104",
    "УПРАВЛЕНИЕ МЫШЬЮ": "11123",
    "ЗЛОДЕЙ-ПРОТАГОНИСТ": "11333",
    "ВИКИНГИ": "11634",
    "ОБУЧЕНИЕ": "12057",
    "СЕКСУАЛЬНЫЙ КОНТЕНТ": "12095",
    "БОКС": "12190",
    "WARHAMMER 40K": "12286",
    "МЕНЕДЖМЕНТ": "12472",
    "ПАСЬЯНС": "13070",
    "АМЕРИКА": "13190",
    "ТАНКИ": "13276",
    "СТРЕЛЬБА ИЗ ЛУКА": "13382",
    "МОРЕПЛАВАНИЕ": "13577",
    "ЭКСПЕРИМЕНТАЛЬНАЯ": "13782",
    "РАЗРАБОТКА ИГР": "13906",
    "ПОШАГОВАЯ ТАКТИКА": "14139",
    "DUNGEONS & DRAGONS": "14153",
    "НОСТАЛЬГИЯ": "14720",
    "НАРОЧИТО НЕУДОБНОЕ УПРАВЛЕНИЕ": "14906",
    "ПОЛЁТЫ": "15045",
    "БЕСЕДЫ": "15172",
    "ФИЛОСОФСКАЯ": "15277",
    "ДОКУМЕНТАЛЬНЫЙ ФИЛЬМ": "15339",
    "РЫБАЛКА": "15564",
    "МОТОКРОСС": "15868",
    "МОЛЧАЛИВЫЙ ГЛАВНЫЙ ГЕРОЙ": "15954",
    "МИФОЛОГИЯ": "16094",
    "АЗАРТНАЯ": "16250",
    "КОСМИЧЕСКИЙ СИМУЛЯТОР": "16598",
    "ТАЙМ-МЕНЕДЖМЕНТ": "16689",
    "ОБОРОТНИ": "17015",
    "РОЛЕВАЯ СТРАТЕГИЯ": "17305",
    "ЛЕММИНГИ": "17337",
    "НАСТОЛЬНАЯ ИГРА": "17389",
    "АСИНХРОННЫЙ МУЛЬТИПЛЕЕР": "17770",
    "КОТИКИ": "17794",
    "БИЛЬЯРД": "17894",
    "FMV-ИГРА": "18594",
    "ПОДВОДНАЯ ЛОДКА": "19780",
    "ЧЁРНАЯ КОМЕДИЯ": "19995",
    "ПОДЗЕМНАЯ": "21006",
    "ТАКТИЧЕСКАЯ РОЛЕВАЯ ИГРА": "21725",
    "VR": "21978",
    "СЕЛЬСКОЕ ХОЗЯЙСТВО": "220585",
    "МИНИ-ГОЛЬФ": "22955",
    "СЛОВЕСНАЯ": "24003",
    "NSFW": "24904",
    "СЕНСОРНОЕ УПРАВЛЕНИЕ": "25085",
    "ПОЛИТИЧЕСКИЙ СИМУЛЯТОР": "26921",
    "УПРАВЛЕНИЕ ГОЛОСОМ": "27758",
    "СНОУБОРДИНГ": "28444",
    "3D VISION": "29363",
    "ПОХОЖА НА DARK SOULS": "29855",
    "ЭМБИЕНТ": "30358",
    "ПРИРОДА": "30927",
    "ЛИСИЦЫ": "31275",
    "ТЕКСТОВАЯ": "31579",
    "ОТОМЭ": "32322",
    "ПОСТРОЕНИЕ КОЛОДЫ": "324176",
    "МАДЖОНГ": "33572",
    "СИМУЛЯТОР РАБОТЫ": "35079",
    "COMBAT FLIGHT SIMULATOR": "37799",
    "SEXUAL THEMES": "40500",
    "СКРИМЕР": "42089",
    "КОДИНГ": "42329",
    "ЭКШЕН-РОГАЛИК": "42804",
    "ЛГБТК+": "44868",
    "РЕСЛИНГ": "47827",
    "РЕГБИ": "49213",
    "ЗАРУБЕЖНАЯ": "50306",
    "РЕЛЬСОВЫЙ ШУТЕР": "56690",
    "ЭЛЕКТРОННАЯ МУЗЫКА": "61357",
    "ПРАВОПИСАНИЕ": "71389",
    "СИМУЛЯТОР ФЕРМЫ": "87918",
    "РАБОТА В МАГАЗИНЕ": "91114",
    "АВИАСИМУЛЯТОР": "92092",
    "КАТАНИЕ": "96359",
    "УЮТНАЯ": "97376",
    "ЭЛЬФЫ": "102530",
    "8-БИТНАЯ МУЗЫКА": "117648",
    "БАЙКИ": "123332",
    "КВАДРОЦИКЛЫ": "129761",
    "ЭЛЕКТРОНИКА": "143739",
    "ОБ ИГРАХ": "150626",
    "КРИКЕТ": "158638",
    "СОЧЕТАНИЕ БЛОКОВ": "176733",
    "КОРОЛЕВСКАЯ БИТВА": "176981",
    "ВЕРОВАНИЯ": "180368",
    "ИНСТРУМЕНТАЛЬНАЯ МУЗЫКА": "189941",
    "ЗАГАДОЧНЫЕ ПОДЗЕМЕЛЬЯ": "198631",
    "МОТОЦИКЛЫ": "198913",
    "СИМУЛЯТОР КОЛОНИИ": "220585",
    "ПОЛНОМЕТРАЖНЫЙ ФИЛЬМ": "233824",
    "ВЕЛОМОТОКРОСС": "252854",
    "АВТОМАТИЗАЦИЯ": "255534",
    "МУСОУ": "323922",
    "ХОККЕЙ": "324176",
    "РОК-МУЗЫКА": "337964",
    "STEAM MACHINE": "348922",
    "ЛУТЕР-ШУТЕР": "353880",
    "СНУКЕР": "363767",
    "КЛИКЕР": "379975",
    "ТРАДИЦИОННЫЙ РОГАЛИК": "454187",
    "ДУШЕВНАЯ": "552282",
    "УСТРОЙСТВА": "603297",
    "IDLE-ИГРА": "615955",
    "ГЕРОЙСКИЙ ШУТЕР": "620519",
    "СОЦИАЛЬНАЯ ДЕДУКЦИЯ": "745697",
    "КВЕСТ-КОМНАТА": "769306",
    "ПАНОРАМНОЕ ВИДЕО": "776177",
    "КАРТОЧНЫЙ БАТТЛЕР": "791774",
    "ВОЛЕЙБОЛ": "847164",
    "АСИММЕТРИЧНАЯ VR": "856791",
    "КОЛЛЕКЦИОНИРОВАНИЕ СУЩЕСТВ": "916648",
    "РОГАЛИК-МЕТРОИДВАНИЯ": "922563",
    "БУМЕРСКИЙ ШУТЕР": "1023537",
    "АВТОБАТТЛЕР": "1084988",
    "КАРТОЧНЫЙ РОГАЛИК": "1091588",
    "СИМУЛЯТОР ЭПИДЕМИИ": "1100686",
    "АВТОСИМУЛЯТОР": "1100687",
    "МЕДИЦИНСКИЙ СИМУЛЯТОР": "1100688",
    "СИМУЛЯТОР ВЫЖИВАНИЯ И КРАФТИНГА В ОТКРЫТОМ МИРЕ": "1100689",
    "ШУТЕР С ЭВАКУАЦИЕЙ": "1199779",
    "СИМУЛЯТОР ХОББИ": "1220528",
    "ФУТБОЛ": "1254546",
    "АМЕРИКАНСКИЙ ФУТБОЛ": "1254552"
}

TAGS_DICT_EN = {
    "INDIE": "492",
    "ACTION": "19",
    "ADVENTURE": "21",
    "CASUAL": "597",
    "SINGLEPLAYER": "4182",
    "RPG": "122",
    "SIMULATION": "599",
    "STRATEGY": "9",
    "EARLY ACCESS": "493",
    "2D": "3871",
    "FREE TO PLAY": "113",
    "3D": "4191",
    "ATMOSPHERIC": "4166",
    "COLORFUL": "4305",
    "STORY RICH": "1742",
    "FANTASY": "1684",
    "EXPLORATION": "3834",
    "MULTIPLAYER": "3859",
    "PUZZLE": "1664",
    "CUTE": "4726",
    "PIXEL GRAPHICS": "3964",
    "COMBAT": "3993",
    "FIRST-PERSON": "3839",
    "ACTION-ADVENTURE": "4106",
    "MASSIVELY MULTIPLAYER": "128",
    "SPORTS": "701",
    "FUNNY": "4136",
    "RELAXING": "1654",
    "VIOLENT": "4667",
    "ARCADE": "1773",
    "ANIME": "4085",
    "SCI-FI": "3942",
    "HORROR": "1667",
    "CONTROLLER": "7481",
    "STYLIZED": "4252",
    "SHOOTER": "1774",
    "THIRD PERSON": "1697",
    "RACING": "699",
    "FAMILY FRIENDLY": "5350",
    "SEXUAL CONTENT": "12095",
    "RETRO": "4004",
    "NUDITY": "6650",
    "PVE": "6730",
    "FEMALE PROTAGONIST": "7208",
    "CHOICES MATTER": "6426",
    "TOP-DOWN": "4791",
    "CO-OP": "1685",
    "REALISTIC": "4175",
    "OPEN WORLD": "1695",
    "PVP": "1775",
    "SURVIVAL": "1662",
    "GORE": "4345",
    "PLATFORMER": "1625",
    "DARK": "4342",
    "LINEAR": "7250",
    "MYSTERY": "5716",
    "CHARACTER CUSTOMIZATION": "4747",
    "CARTOONY": "4195",
    "COMEDY": "1719",
    "MULTIPLE ENDINGS": "6971",
    "VISUAL NOVEL": "3799",
    "PHYSICS": "3968",
    "2D PLATFORMER": "5379",
    "PSYCHOLOGICAL HORROR": "1721",
    "ONLINE CO-OP": "3843",
    "FPS": "1663",
    "MAGIC": "4057",
    "OLD SCHOOL": "3916",
    "SANDBOX": "3810",
    "ROGUELIKE": "1716",
    "MEDIEVAL": "4172",
    "TACTICAL": "1708",
    "ACTION RPG": "4231",
    "HAND-DRAWN": "6815",
    "ROGUELITE": "3959",
    "FUTURISTIC": "4295",
    "MINIMALIST": "4094",
    "MANAGEMENT": "12472",
    "BUILDING": "1643",
    "DIFFICULT": "4026",
    "CRAFTING": "1702",
    "POINT & CLICK": "1698",
    "DRAMA": "5984",
    "IMMERSIVE SIM": "9204",
    "CARTOON": "4562",
    "SPACE": "1755",
    "RESOURCE MANAGEMENT": "8945",
    "DARK FANTASY": "4604",
    "EMOTIONAL": "5608",
    "3D PLATFORMER": "5395",
    "VR": "21978",
    "PROCEDURAL GENERATION": "5125",
    "CHOOSE YOUR OWN ADVENTURE": "4486",
    "ROMANCE": "4947",
    "SURVIVAL HORROR": "3978",
    "LOGIC": "6129",
    "ACTION ROGUELIKE": "42804",
    "LOCAL MULTIPLAYER": "7368",
    "NATURE": "30358",
    "INTERACTIVE FICTION": "11014",
    "TURN-BASED COMBAT": "4325",
    "MATURE": "5611",
    "TURN-BASED TACTICS": "14139",
    "SIDE SCROLLER": "3798",
    "TURN-BASED STRATEGY": "1741",
    "HACK AND SLASH": "1646",
    "SHOOT 'EM UP": "4255",
    "GREAT SOUNDTRACK": "1756",
    "HENTAI": "9130",
    "BASE BUILDING": "7332",
    "EDUCATION": "1036",
    "PUZZLE PLATFORMER": "5537",
    "HIDDEN OBJECT": "1738",
    "DATING SIM": "9551",
    "1990'S": "6691",
    "POST-APOCALYPTIC": "3835",
    "SURREAL": "1710",
    "DESIGN & ILLUSTRATION": "84",
    "BULLET HELL": "4885",
    "WAR": "1678",
    "ZOMBIES": "1659",
    "1980S": "7743",
    "DUNGEON CRAWLER": "1720",
    "WALKING SIMULATOR": "5900",
    "UTILITIES": "87",
    "TABLETOP": "17389",
    "JRPG": "4434",
    "CINEMATIC": "4145",
    "NSFW": "24904",
    "STEALTH": "1687",
    "SCORE ATTACK": "5154",
    "NARRATION": "5094",
    "LOCAL CO-OP": "3841",
    "CONVERSATION": "15172",
    "TEXT-BASED": "31275",
    "HISTORICAL": "3987",
    "LGBTQ+": "44868",
    "PARTY-BASED RPG": "10695",
    "LIFE SIM": "10235",
    "CARD GAME": "1666",
    "LORE-RICH": "3854",
    "INVESTIGATION": "8369",
    "2.5D": "4975",
    "CLICKER": "379975",
    "INVENTORY MANAGEMENT": "6276",
    "THIRD-PERSON SHOOTER": "3814",
    "MILITARY": "4168",
    "REPLAY VALUE": "4711",
    "ISOMETRIC": "5851",
    "PSYCHOLOGICAL": "5186",
    "TOP-DOWN SHOOTER": "4637",
    "THRILLER": "4064",
    "NONLINEAR": "6869",
    "DEMONS": "9541",
    "ALIENS": "1673",
    "DARK HUMOR": "5923",
    "SUPERNATURAL": "10808",
    "TURN-BASED": "1677",
    "ECONOMY": "4695",
    "TUTORIAL": "12057",
    "TEAM-BASED": "5711",
    "ROBOTS": "5752",
    "CYBERPUNK": "4115",
    "STRATEGY RPG": "17305",
    "TIME MANAGEMENT": "16689",
    "REAL TIME TACTICS": "3813",
    "ARTIFICIAL INTELLIGENCE": "7926",
    "DETECTIVE": "5613",
    "RTS": "1676",
    "ABSTRACT": "4400",
    "MODERN": "5673",
    "PERMA DEATH": "1759",
    "DRIVING": "1644",
    "ARENA SHOOTER": "5547",
    "DYSTOPIAN ": "5030",
    "LOOT": "4236",
    "PRECISION PLATFORMER": "3877",
    "DECKBUILDING": "32322",
    "TOWER DEFENSE": "1645",
    "COLLECTATHON": "5652",
    "BOARD GAME": "1770",
    "MEMES": "10397",
    "PSYCHEDELIC": "1714",
    "SOULS-LIKE": "29482",
    "WEB PUBLISHING": "1038",
    "IDLER": "615955",
    "COMIC BOOK": "1751",
    "TACTICAL RPG": "21725",
    "CITY BUILDER": "4328",
    "SOFTWARE": "8013",
    "ALTERNATE HISTORY": "4598",
    "WARGAME": "4684",
    "4 PLAYER LOCAL": "4840",
    "MYTHOLOGY": "16094",
    "GAME DEVELOPMENT": "13906",
    "ANIMATION & MODELING": "872",
    "FAST-PACED": "1734",
    "SHORT": "4234",
    "BEAT 'EM UP": "4158",
    "CARD BATTLER": "791774",
    "METROIDVANIA": "1628",
    "FLIGHT": "15045",
    "DESTRUCTION": "5363",
    "RUNNER": "8666",
    "LEVEL EDITOR": "8122",
    "PARKOUR": "4036",
    "GRID-BASED MOVEMENT": "7569",
    "CATS": "17894",
    "CRIME": "6378",
    "SOUNDTRACK": "7948",
    "CRPG": "4474",
    "MODDABLE": "1669",
    "MUSIC": "1621",
    "CLASS-BASED": "4155",
    "CAPITALISM": "4845",
    "CREATURE COLLECTOR": "916648",
    "2D FIGHTER": "4736",
    "RPGMAKER": "5577",
    "PHILOSOPHICAL": "15277",
    "DARK COMEDY": "19995",
    "GUN CUSTOMIZATION": "5765",
    "AUTOMOBILE SIM": "1100687",
    "AUTOMATION": "255534",
    "CLASSIC": "1693",
    "MMORPG": "1754",
    "FIGHTING": "1743",
    "RHYTHM": "1752",
    "SWORDPLAY": "4608",
    "VEHICULAR COMBAT": "11104",
    "COMPETITIVE": "3878",
    "3D FIGHTER": "6506",
    "TWIN STICK SHOOTER": "4758",
    "SCIENCE": "5794",
    "CO-OP CAMPAIGN": "4508",
    "FARMING SIM": "87918",
    "TRADING": "4202",
    "LOVECRAFTIAN": "7432",
    "VIDEO PRODUCTION": "784",
    "EXPERIMENTAL": "13782",
    "COOKING": "3920",
    "AMERICA": "13190",
    "NOIR": "6052",
    "DRAGONS": "4046",
    "AUDIO PRODUCTION": "1027",
    "BATTLE ROYALE": "176981",
    "ESPORTS": "5055",
    "MOVIE": "4700",
    "CONSPIRACY": "5372",
    "COZY": "97376",
    "GRAND STRATEGY": "4364",
    "QUICK-TIME EVENTS": "4559",
    "SPACE SIM": "16598",
    "BEAUTIFUL": "5411",
    "3D VISION": "29363",
    "WORLD WAR II": "4150",
    "COLONY SIM": "220585",
    "PARODY ": "4878",
    "6DOF": "4835",
    "SPLIT SCREEN": "10816",
    "MYSTERY DUNGEON": "198631",
    "WORD GAME": "24003",
    "SATIRE": "1651",
    "AUTO BATTLER": "1084988",
    "DYNAMIC NARRATION": "9592",
    "GOTHIC": "3952",
    "LOOTER SHOOTER": "353880",
    "BULLET TIME": "5796",
    "AGRICULTURE": "22602",
    "UNDERGROUND": "21006",
    "MATCH 3": "1665",
    "HERO SHOOTER": "620519",
    "TIME MANIPULATION": "6625",
    "SPECTACLE FIGHTER": "4777",
    "MARTIAL ARTS": "6915",
    "COMBAT RACING": "4102",
    "BLOOD": "5228",
    "OPEN WORLD SURVIVAL CRAFT": "1100689",
    "MINING": "5981",
    "POLITICAL": "4853",
    "MECHS": "4821",
    "SOFTWARE TRAINING": "1445",
    "VOXEL": "1732",
    "TIME TRAVEL": "10679",
    "DOG": "1638",
    "ACTION RTS": "1723",
    "FISHING": "15564",
    "NARRATIVE": "7702",
    "OTOME": "31579",
    "IMMERSIVE": "3934",
    "STEAMPUNK": "1777",
    "FMV": "18594",
    "VAMPIRE": "4018",
    "PIRATES": "1681",
    "ASYNCHRONOUS MULTIPLAYER": "17770",
    "GOD GAME": "5300",
    "SOLITAIRE": "13070",
    "WHOLESOME": "552282",
    "HUNTING": "9564",
    "TRADING CARD GAME": "9271",
    "NINJA": "1688",
    "TRANSPORTATION": "10383",
    "CHARACTER ACTION GAME": "3955",
    "POLITICS": "4754",
    "MOBA": "1718",
    "TANKS": "13276",
    "UNDERWATER": "9157",
    "HEX GRID": "1717",
    "ROGUELIKE DECKBUILDER": "1091588",
    "HACKING": "5502",
    "FAITH": "180368",
    "ILLUMINATI": "7478",
    "ASSASSIN": "4376",
    "4X": "1670",
    "SUPERHERO": "1671",
    "SOKOBAN": "1730",
    "GAMBLING": "16250",
    "POLITICAL SIM": "26921",
    "PARTY GAME": "7178",
    "DINOSAURS": "5160",
    "BOOMER SHOOTER": "1023537",
    "TRAINS": "1616",
    "ADDICTIVE": "4190",
    "PARTY": "7108",
    "REMAKE": "5708",
    "PHOTO EDITING": "809",
    "MOUSE ONLY": "11123",
    "COLD WAR": "5179",
    "WESTERN": "1647",
    "PROGRAMMING": "5432",
    "HEIST": "1680",
    "DIPLOMACY": "6310",
    "FOREIGN": "51306",
    "MINIGAMES": "8093",
    "ARCHERY": "13382",
    "TYPING": "1674",
    "SNOW": "9803",
    "REAL-TIME": "4161",
    "NAVAL": "6910",
    "EPISODIC": "4242",
    "ESCAPE ROOM": "769306",
    "EPIC": "3965",
    "NAVAL COMBAT": "4994",
    "SAILING": "13577",
    "TRANSHUMANISM": "4137",
    "CULT CLASSIC": "7782",
    "HORSES": "6041",
    "REAL-TIME WITH PAUSE": "7107",
    "SNIPER": "7423",
    "VILLAIN PROTAGONIST": "11333",
    "NOSTALGIA": "14720",
    "WEREWOLVES": "17015",
    "OFFROAD": "7622",
    "TRADITIONAL ROGUELIKE": "454187",
    "ON-RAILS SHOOTER": "56690",
    "DUNGEONS & DRAGONS": "14153",
    "TRIVIA": "10437",
    "MUSIC-BASED PROCEDURAL GENERATION": "8253",
    "FARMING": "4520",
    "SEQUEL": "5230",
    "TIME ATTACK": "5390",
    "FOOTBALL (SOCCER)": "1254546",
    "MARS": "6702",
    "WORLD WAR I": "5382",
    "TOUCH-FRIENDLY": "25085",
    "MOD": "5348",
    "BOXING": "12190",
    "SPELLING": "71389",
    "360 VIDEO": "776177",
    "JET": "92092",
    "KICKSTARTER": "5153",
    "OUTBREAK SIM": "1100686",
    "SPACESHIPS": "4291",
    "ROGUEVANIA": "922563",
    "EXPERIENCE": "9994",
    "GAMING": "150626",
    "CHESS": "4184",
    "MOTORBIKE": "198913",
    "GAMEMAKER": "1649",
    "GAMES WORKSHOP": "5310",
    "MEDICAL SIM": "1100688",
    "UNFORGIVING": "1733",
    "SUBMARINE": "19780",
    "BASKETBALL": "1746",
    "BIKES": "123332",
    "ROME": "6948",
    "GOLF": "7038",
    "LEGO": "1736",
    "DWARF": "7918",
    "JUMP SCARE": "42089",
    "JOB SIMULATOR": "35079",
    "ASYMMETRIC VR": "856791",
    "SOCIAL DEDUCTION": "745697",
    "BASEBALL": "5727",
    "PINBALL": "6621",
    "ELECTRONIC MUSIC": "61357",
    "AMBIENT": "29855",
    "SILENT PROTAGONIST": "15954",
    "DOCUMENTARY": "15339",
    "WRESTLING": "47827",
    "SKATEBOARDING": "1753",
    "FOOTBALL (AMERICAN)": "1254552",
    "INSTRUMENTAL MUSIC": "189941",
    "MINI GOLF": "22955",
    "CROWDFUNDED": "7113",
    "EXTRACTION SHOOTER": "1199779",
    "WARHAMMER 40K": "12286",
    "WELL-WRITTEN": "8461",
    "ROCK MUSIC": "337964",
    "BOSS RUSH": "11095",
    "POOL": "17927",
    "CYCLING": "19568",
    "SKATING": "96359",
    "TRACKIR": "8075",
    "TENNIS": "5914",
    "VIKINGS": "11634",
    "INTENTIONALLY AWKWARD CONTROLS": "14906",
    "DICE": "7556",
    "MOTOCROSS": "15868",
    "SHOP KEEPER": "91114",
    "BASED ON A NOVEL": "3796",
    "TILE-MATCHING": "176733",
    "BOWLING": "7328",
    "HOCKEY": "324176",
    "8-BIT MUSIC": "117648",
    "ATV": "129761",
    "SNOWBOARDING": "28444",
    "LEMMINGS": "17337",
    "SKIING": "7309",
    "BMX": "252854",
    "HARDWARE": "603297",
    "BIRDS": "6214",
    "BENCHMARK": "5407",
    "MAHJONG": "33572",
    "STEAM MACHINE": "348922",
    "ELF": "102530",
    "ELECTRONIC": "143739",
    "MUSOU": "323922",
    "FOX": "30927",
    "VOICE CONTROL": "27758",
    "CODING": "42329",
    "FEATURE FILM": "233824",
    "HOBBY SIM": "1220528",
    "VOLLEYBALL": "847164",
    "CRICKET": "158638",
    "RUGBY": "49213",
    "REBOOT": "5941",
    "SNOOKER": "363767",
}


import requests
from bs4 import BeautifulSoup
import re

# API Groq
GROQ_API_KEY = "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"
GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions"

def analyze_input_with_qwen_en(user_input, TAGS_DICT):
    """
    Анализирует текст запроса для извлечения параметров поиска (меток, цены, лимита) с помощью API Groq.
    """
    try:
        if not user_input.strip():
            return "Ошибка: пустой запрос. Введите запрос корректно."

        headers = {
            "Authorization": f"Bearer {GROQ_API_KEY}",
            "Content-Type": "application/json"
        }
        prompt = f"""
        Process the text and take out tags, price and the amout of games. Put them into their relative variables:
        user_tags, min_price, max_price, limit_input (if lower price bound is not specified, then it's None, if upper bound is not specified - None, if the amount of desired games is not specified, then set it to 10):
        Example:
        "I want five pixel rpg games no more expensive than 20 dollars"
        user_tags = [RPG, Pixel Graphics]
        min_price = None
        max_price = 20
        limit_input = 5
        The answer must look like this, do not add anything else:
        user_tags = [RPG, Pixel Graphics]
        min_price = None
        max_price = 20
        limit_input = 5
        """

        full_prompt = f"Метки: {TAGS_DICT}\n{prompt}\n{user_input}"

        payload = {
                "model": "llama3-70b-8192",
                "messages": [
                    {"role": "system", "content": "Будь кратким и лаконичным."},
                    {"role": "user", "content": full_prompt}
                ],
                "temperature": 0.7,
            }

        response = requests.post(GROQ_API_URL, json=payload, headers=headers)
        response.raise_for_status()
        response_data = response.json()

        if "choices" in response_data and response_data["choices"]:
            return response_data["choices"][0]["message"]["content"]
        else:
            return "Ошибка: неверный формат ответа от API Groq."

    except requests.exceptions.RequestException as e:
        return f"Ошибка: сбой запроса к API Groq - {e}"
    except Exception as e:
        return f"Ошибка: неожиданная ошибка - {e}"

def analyze_input_with_qwen(user_input, TAGS_DICT):
    """
    Анализирует текст запроса для извлечения параметров поиска (меток, цены, лимита) с помощью API Groq.
    """
    try:
        if not user_input.strip():
            return "Ошибка: пустой запрос. Введите запрос корректно."

        headers = {
            "Authorization": f"Bearer {GROQ_API_KEY}",
            "Content-Type": "application/json"
        }
        prompt = f"""
        Обработай предложение и выдели из него метки, цену и количество игр, вставив их в соответствующие переменные:
        user_tags, min_price, max_price, limit_input (если не указывается нижний порог цены, то None, если верхний не указывается - None, если количество игр не указано, то 10):
        Пример:
        "Хочу пять RPG игр до 500 рублей."
        user_tags = [Ролевая игра, Пиксельная графика]
        min_price = None
        max_price = 500
        limit_input = 5
        Ответ выводи ТОЛЬКО следующим образом, ничего другого не пиши:
        user_tags = [Аниме, Пиксельная графика]
        min_price = None
        max_price = 600
        limit_input = 10
        """

        full_prompt = f"Метки: {TAGS_DICT}\n{prompt}\n{user_input}"

        payload = {
                "model": "llama3-70b-8192",
                "messages": [
                    {"role": "system", "content": "Будь кратким и лаконичным."},
                    {"role": "user", "content": full_prompt}
                ],
                "temperature": 0.7,
            }

        response = requests.post(GROQ_API_URL, json=payload, headers=headers)
        response.raise_for_status()
        response_data = response.json()

        if "choices" in response_data and response_data["choices"]:
            return response_data["choices"][0]["message"]["content"]
        else:
            return "Ошибка: неверный формат ответа от API Groq."

    except requests.exceptions.RequestException as e:
        return f"Ошибка: сбой запроса к API Groq - {e}"
    except Exception as e:
        return f"Ошибка: неожиданная ошибка - {e}"


def fetch_tag_id(tag_name, lang):
    search_url = "https://store.steampowered.com/tag/browse/"
    try:
        response = requests.get(search_url)
        response.raise_for_status()

        soup = BeautifulSoup(response.text, 'html.parser')
        tag_elements = soup.find_all('a', class_='tag_browse_tag')
        
        for tag_element in tag_elements:
            tag_text = tag_element.text.strip().upper()
            if tag_text == tag_name.upper():
                return tag_element.get('data-tagid')
    except Exception as e:
        if lang == "ru":
            print(f"Ошибка при поиске ID метки '{tag_name}': {e}")
        else:
            print(f"Error while searching tag ID '{tag_name}': {e}")
    return None

def get_game_price_and_tags(appid, lang):
    try:
        if lang == "ru":
            url_api = f"https://store.steampowered.com/api/appdetails?appids={appid}&cc=ru&l=russian"
            response = requests.get(url_api)
            if response.status_code == 200:
                data = response.json()
                if data[str(appid)]['success']:
                    game_data = data[str(appid)]['data']
                    if game_data.get('type') != 'game':
                        return None
    
                    image = game_data.get('capsule_image', 'Nan')
                    name = game_data.get('name', 'Название недоступно')
                    price_overview = game_data.get('price_overview', {})
                    final_price = price_overview.get('final_formatted', 'Бесплатно')
    
                    url_store = f"https://store.steampowered.com/app/{appid}/"
                    page_response = requests.get(url_store, headers={'Accept-Language': 'ru'})
                    if page_response.status_code == 200:
                        soup = BeautifulSoup(page_response.content, 'html.parser')
                        tags = soup.find_all('a', class_='app_tag', limit=10)
                        tags_list = [tag.text.strip() for tag in tags]
    
                        cats = soup.find_all(class_='label')
                        cats_list = [cat.text.strip() for cat in cats]
    
                        conts = soup.find_all('data-featuretarget')
                    else:
                        tags_list = ['Метки недоступны']
                        cats_list = ['Категории недоступны']
    
                    
                    return {
                        'Лого' : image,
                        'Название': name,
                        'Цена': final_price,
                        'Метки': tags_list,
                        'Категории': cats_list,
                        'Ссылка': url_store,
                    }
        else:
            url_api = f"https://store.steampowered.com/api/appdetails?appids={appid}&cc=us&l=english"
            response = requests.get(url_api)
            if response.status_code == 200:
                data = response.json()
                if data[str(appid)]['success']:
                    game_data = data[str(appid)]['data']
                    if game_data.get('type') != 'game':
                        return None
    
                    image = game_data.get('capsule_image', 'Nan')
                    name = game_data.get('name', 'Name unavailable')
                    price_overview = game_data.get('price_overview', {})
                    final_price = price_overview.get('final_formatted', 'Free to Play')
                    url_store = f"https://store.steampowered.com/app/{appid}/"
                    page_response = requests.get(url_store, headers={'Accept-Language': 'en'})
                    if page_response.status_code == 200:
                        soup = BeautifulSoup(page_response.content, 'html.parser')
                        tags = soup.find_all('a', class_='app_tag', limit=10)
                        tags_list = [tag.text.strip() for tag in tags]
    
                        cats = soup.find_all(class_='label')
                        cats_list = [cat.text.strip() for cat in cats]
    
                        conts = soup.find_all('data-featuretarget')
                    else:
                        tags_list = ['Tags unavailable']
                        cats_list = ['Categories unavailable']
    
                    
                    return {
                        'Logo' : image,
                        'Name': name,
                        'Price': final_price,
                        'Tags': tags_list,
                        'Categories': cats_list,
                        'Link': url_store,
                    }
    except Exception as e:
        if lang == "ru":
            print(f"Ошибка при обработке AppID {appid}: {e}")
        else:
            print(f"Error while processing AppID {appid}: {e}")
    return None

def fetch_games_by_tags_and_price(lang, tags, price_range=None, limit=50):
    tag_ids = []
    print("tags = ", tags)
    for tag in tags:
        tag_upper = tag.strip().upper()
        print("tag_upper = ", tag_upper)
        if lang == "ru":
            if tag_upper in TAGS_DICT:
                tag_ids.append(TAGS_DICT[tag_upper])
            else:
                fetched_id = fetch_tag_id(tag_upper, lang)
                if fetched_id:
                    TAGS_DICT[tag_upper] = fetched_id  # Сохраняем в локальный словарь
                    tag_ids.append(fetched_id)
        else:
            if tag_upper in TAGS_DICT_EN:
                tag_ids.append(TAGS_DICT_EN[tag_upper])
            else:
                fetched_id = fetch_tag_id(tag_upper, lang)
                if fetched_id:
                    TAGS_DICT_EN[tag_upper] = fetched_id  # Сохраняем в локальный словарь
                    tag_ids.append(fetched_id)
            
    if not tag_ids:
        if lang == "ru":
            print("Не удалось найти соответствующие метки.")
        else:
            print("Could not find relevant tags")
        return []

    search_url = "https://store.steampowered.com/search/"
    found_games = []
    processed_games = 0
    min_price, max_price = price_range if price_range else (None, None)

    for page in range(1, 5):
        if lang == "ru":
            params = {
                "tags": ",".join(tag_ids),
                "page": page,
                "cc": "ru",
                "l": "russian"
            }
        else:
            params = {
                "tags": ",".join(tag_ids),
                "page": page,
                "cc": "us",
                "l": "english"
            }

        try:
            response = requests.get(search_url, params=params)
            response.raise_for_status()

            soup = BeautifulSoup(response.text, 'html.parser')
            results = soup.find_all('a', class_='search_result_row')

            for result in results:
                appid = result.get('data-ds-appid')
                if not appid:
                    continue

                game_details = get_game_price_and_tags(appid, lang)
                if not game_details:
                    continue
                if lang == "ru":
                    price_text = game_details['Цена'].replace("руб.", "").strip()
                else:
                    price_text = game_details['Price'].replace("$", "").strip()
                try:
                    game_price = float(price_text)
                except ValueError:
                    game_price = 0

                if (min_price is None or game_price >= min_price) and (max_price is None or game_price <= max_price):
                    found_games.append(game_details)
                    processed_games += 1

                    if processed_games >= limit:
                        return found_games
        except Exception as e:
            if lang == "ru":
                print(f"Ошибка при получении данных: {e}")
            else:
                print(f"Error fetching data: {e}")

    return found_games



def search_games(user_input, page_language="ru"):
    """
    Обрабатывает пользовательский запрос и возвращает список подходящих игр
    на выбранном языке (ru/en), но с единой структурой ключей.
    """
    print(f"Обрабатываем запрос: {user_input}")

    if page_language == "ru":
        ai_response = analyze_input_with_qwen(user_input, TAGS_DICT)
    else:
        ai_response = analyze_input_with_qwen_en(user_input, TAGS_DICT_EN)

    print(ai_response)

    if not ai_response:
        return "Не удалось обработать запрос. Попробуйте ещё раз." if page_language == "ru" else "Could not process the request. Try again."

    # Извлечение параметров
    tags_pattern = r"user_tags = \[(.*?)\]"
    price_pattern = r"min_price = (\d+|None)\s+max_price = (\d+|None)"
    limit_pattern = r"limit_input = (\d+)"

    tags_match = re.search(tags_pattern, ai_response)
    price_match = re.search(price_pattern, ai_response)
    limit_match = re.search(limit_pattern, ai_response)

    tags = [tag.strip().strip("'") for tag in tags_match.group(1).split(", ")] if tags_match else []
    min_price = int(price_match.group(1)) if price_match and price_match.group(1).isdigit() else None
    max_price = int(price_match.group(2)) if price_match and price_match.group(2).isdigit() else None
    limit = int(limit_match.group(1)) if limit_match and limit_match.group(1).isdigit() else 10

    price_range = (min_price, max_price)
    games = fetch_games_by_tags_and_price(page_language, tags, price_range, limit=limit)

    """
    if games:
        print(f"Найдено {len(games)} игр:")
        for game in games:
            print(f"{game['Лого']}, Название: {game['Название']}, Цена: {game['Цена']}, Метки: {', '.join(game['Метки'][:4])}, Ссылка: {game['Ссылка']}")
    else:
        print("Подходящих игр не найдено.")
    """
    return games

if __name__ == "__main__":
    data = search_games("шутер до 300р")
    print(data)
    print()        
